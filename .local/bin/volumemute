#!/bin/bash
# requires pamixer to test whether audio is muted

pactl set-sink-mute @DEFAULT_SINK@ toggle

currentvolume() {
	pamixer --get-volume
}

volume=$(currentvolume)

send_notification_unmuted() {
	volume=$(currentvolume)
	count=$(( $volume / 10 ))
	bar=$(seq -s "" $(( $count + 1 )) | sed 's/[0-9]//g')
	symbol=""
	if (( $(( $count * 10 - $volume )) == 0 )); then
		symbol=""
	fi
	if (( $count == 10 )); then
		symbol=""
	fi
	barempty=$(seq -s "" $(( 10 - count )) | sed 's/[0-9]//g')
	# makoctl dismiss --all && \
	notify-send -i audio-volume-high-symbolic.symbolic -c audio "$bar$symbol$barempty"
}
send_notification_muted() {
	volume=$(currentvolume)
	count=$(( $volume / 10 ))
	bar=$(seq -s "" $(( $count + 1 )) | sed 's/[0-9]//g')
	symbol=""
	if (( $(( $count * 10 - $volume )) == 0 )); then
		symbol=""
	fi
	if (( $count == 10 )); then
		symbol=""
	fi
	barempty=$(seq -s "" $(( 10 - count )) | sed 's/[0-9]//g')
	# makoctl dismiss --all && \
	notify-send -i audio-volume-muted-symbolic.symbolic -c audio "$bar$symbol$barempty"
}

correctly_notify_muted() {
	makoctl dismiss --all && \
	send_notification_muted
}

correctly_notify_unmuted() {
	# makoctl dismiss --all && \
	send_notification_unmuted
}

if [[ $(pamixer --get-mute) == true ]]; then
	correctly_notify_muted ; else
	correctly_notify_unmuted
fi

